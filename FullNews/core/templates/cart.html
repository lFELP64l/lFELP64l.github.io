{% extends "core/base.html" %}

{% block content %}
<div class="conteiner">
    <div class="p-5 bg-dark text-white text-center">CARRITO DE COMPRAS <br> ( los premium que compres ademas del tuyo, los tomaremos como donacion :D ) </div>
    <div class="d-flex justify-content-center row">
      <section class="intro">
        <div class="bg-image h-100" style="background-color: #6095F0;">
          <div class="mask d-flex align-items-center h-100">
            <div class="container">
              <div class="row justify-content-center">
                <div class="col-12">
                  <div class="card shadow-2-strong" style="background-color: #f5f7fa;">
                    <div class="card-body">
                      <div class="table-responsive">
                        <table class="table table-borderless mb-0 ">
                          <thead>
                            <tr>
                              <th scope="col" class="text-center">Producto</th>
                              <th scope="col" class="text-center">Cantidad</th>
                              <th scope="col" class="text-center">Precio</th>
                              <th scope="col" class="text-center">Total</th>
                            </tr>
                          </thead>
                          <tbody>
                            {% for item in cart_items %}
                            <tr>
                              <td class="text-center">{{ item.product.name }}</td>
                              <td class="text-center">{{ item.quantity }}</td>
                              <td class="text-center">{{ item.product.price }}</td>
                              <td class="text-center">{{ item.total_price }}</td>
                            </tr>
                            {% empty %}
                            <tr>
                              <td colspan="3">No hay periodistas disponibles.</td>
                            </tr>
                            {% endfor %}
                          </tbody>
                        </table>
                            <form action="{% url 'add_to_cart' 1 %}" class="d-flex justify-content-center mb-2" method="post">{% csrf_token %}<button class="btn btn-primary"
                                type="submit">uno mas :D</button></form>
                            <form action="{% url 'salir_to_cart' 1 %}" class="d-flex justify-content-center mb-2" method="post">{% csrf_token %}<button class="btn btn-primary"
                                type="submit">uno menos D:</button></form>
                        <div class="p-2 bg-dark text-white text-center">
                            Total a pagar: {{ total_price }} USD
                            <div style="justify-content: center;" class="text-center" id="paypal-button"></div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>

  <script src="https://www.paypalobjects.com/api/checkout.js"></script>
  <script>
    paypal.Button.render({
      // Configure environment
      env: 'sandbox',
      client: {
        sandbox: 'AVBYAN121XVQMGs7pJnSwpvGLzUTKLSeCCSaqcaopau98JsJtqKqRVoBsahVKDOR0Eb2LV2EJdeaGBtO',
        production: 'demo_production_client_id'
      },
      // Customize button (optional)
      locale: 'en_US',
      style: {
        size: 'small',
        color: 'gold',
        shape: 'pill',
      },
      // Enable Pay Now checkout flow (optional)
      commit: true,
      // Set up a payment
      payment: function (data, actions) {
        return actions.payment.create({
          transactions: [{
            amount: {
              total: '{{ total_price | floatformat:2 }}'.replace(',', '.'),
              currency: 'USD'
            }
          }]
        });
      },
      // Execute the payment
      onAuthorize: function (data, actions) {
        return actions.payment.execute().then(function () {
          // Show a confirmation message to the buyer
          window.alert('gracias por comprar!');
        });
      }
    }, '#paypal-button');
  </script>
{% endblock %}
